# **程序异常的数据丢失**

　　当你开发者程序的时候，莫名的碰到，应用程序返回上一级页面发现内容为空，或者按home键一会后再次返回，会发现你的界面上控件的内容都是空。这说明你的手机内存较低，你的页面已经被回收了。  

1。 **onSaveInstanceState的使用**  

　　首先看一下默认的实现：   

```
protected void onSaveInstanceState(Bundle outState) {  
    super.onSaveInstanceState(outState);  
}   
```
  
　　如上所示，首先可以看到：onaveInsatnceState的入参是一个Bundle对象，由此决定了**要保存的内容，必须是序列化的内容**。    

　　关于序列化，Android提供了两种：Serializable和Parcelable，建议使用Parcelable，效率更高。  
　　当你的界面被回收之后，如果你再次返回，回到用onCreate函数，如下：  

```
protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
}
```
　　同时你会发现入参savedInstanceState != null。 你可以通话此参数来判断是否该页面已经被回收，从而进行相应的逻辑处理。  
　　有时候调用onSaveInstanceState，当你再次返回，有时候并不会调用onCreate函数，而是调用onRestoreInstanceState，而且这个函数一定会被调用。onSaveInstanceState和onRestoreInstanceState是一对。  

　　onSaveInstanceState在什么时候会被调用？ 有这么几种情况：  
　　1. 当用户按下Home键的时候（包括长按Home运行其他程序）  
　　2. 按下电源键，关闭屏幕  
　　3. Activity A启动进入Activity B  
　　4. 屏幕方向切换   

　　总而言之，onSaveInstanceState的调用遵循一个重要原则，即当系统“未经你许可”时销毁了你的activity，则onSaveInstanceState会被系统调用，这是系统的责任，因为它必须要提供一个机会让你保存你的数据（当然你不保存那就随便你了）  
　　虽然onSaveInstanceState和onRestoreInstanceState是一对，但是并不是同时都会被调用。比如： 用户按下HOME键回到主界面，然后用户紧接着又返回到activity A，这种情况下activity A一般不会因为内存的原因被系统销毁，故activity A的onRestoreInstanceState方法不会被执行。

2。 **模拟内存回收Activity**
  
　　开发的时候，你的测试机有时候怎么也不会回收你的app页面，怎么进行调试你的保护代码呢。  
　　实际上，android提供了这种方式：   **设置-开发者选项-选择不保留当前的活动**。当你设置过之后，只要是当前的页面不存在了，当前的activity都会被回收。 这样你就可以很好地调试这种场景了。  
　　另外还需要注意的是：**国内很多rom优化过相机，有些手机当你在你的app内调用系统的相机，返回后上一个界面经常会被回收。**  

3。


